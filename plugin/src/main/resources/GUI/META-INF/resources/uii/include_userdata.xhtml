<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:zlb="http://xmlns.jcp.org/jsf/composite/composites"
    template="/uii/template/reduced_content_template.html">
    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <!-- Main Headings for individual views -->
        <ui:fragment rendered="#{DashboardForm.plugin.navigation=='userdata'}">
            <h1 class="page__heading">
                <span>#{msgs.plugin_dashboard_delivery_deliverUserData}</span>

                <span
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="#{msgs.plugin_rest_usercreation_helpText_page}">
                <button
                    type="button"
                    class="btn page__help"
                    aria-label="#{msgs.plugin_dashboard_delivery_pageHelp}"
                    data-bs-toggle="modal"
                    data-bs-title="help title"
                    data-bs-target="#pageHelpModal">
                    <ui:include src="/uii/includes/icon-help.xhtml" />
                </button>
                </span>
            </h1>
        </ui:fragment>

        <ui:fragment rendered="#{DashboardForm.plugin.navigation=='user'}">
            <h1 class="page__heading">
                <span>#{msgs.plugin_dashboard_delivery_deliverUserData}</span>

                <span
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="#{msgs.plugin_rest_usercreation_helpText_page}">
                <button
                    type="button"
                    class="btn page__help"
                    aria-label="#{msgs.plugin_dashboard_delivery_pageHelp}"
                    data-bs-toggle="modal"
                    data-bs-title="help title"
                    data-bs-target="#pageHelpModal">
                    <ui:include src="/uii/includes/icon-help.xhtml" />
                </button>
                </span>
            </h1>
        </ui:fragment>

        <ui:fragment rendered="#{DashboardForm.plugin.navigation=='institution'}">
            <h1 class="page__heading">
                <span>#{msgs.plugin_dashboard_delivery_deliverInstitutionData}</span>

                <span
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="#{msgs.plugin_rest_usercreation_helpText_page}">
                <button
                    type="button"
                    class="btn page__help"
                    aria-label="#{msgs.plugin_dashboard_delivery_pageHelp}"
                    data-bs-toggle="modal"
                    data-bs-title="help title"
                    data-bs-target="#pageHelpModal">
                    <ui:include src="/uii/includes/icon-help.xhtml" />
                </button>
                </span>
            </h1>
        </ui:fragment>

        <ui:fragment rendered="#{DashboardForm.plugin.navigation=='contact'}">
            <h1 class="page__heading">
                <span>#{msgs.plugin_dashboard_delivery_deliverContactPersonData}</span>

                <span
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="#{msgs.plugin_rest_usercreation_helpText_page}">
                <button
                    type="button"
                    class="btn page__help"
                    aria-label="#{msgs.plugin_dashboard_delivery_pageHelp}"
                    data-bs-toggle="modal"
                    data-bs-title="help title"
                    data-bs-target="#pageHelpModal">
                    <ui:include src="/uii/includes/icon-help.xhtml" />
                </button>
                </span>
            </h1>
        </ui:fragment>


        <!-- User options => panel view -->
        <ui:fragment rendered="#{DashboardForm.plugin.navigation=='userdata'}">


            <ui:include src="includes/helpModalsDD.xhtml">
                <ui:param
                    name="header"
                    value="plugin_dashboard_delivery_userdata_options_helpHeader" />
                <ui:param
                    name="body1"
                    value="plugin_dashboard_delivery_userdata_options_helpBody1" />
                <ui:param
                    name="body2"
                    value="plugin_dashboard_delivery_userdata_options_helpBody2" />
                <ui:param
                    name="img"
                    value="plugin_dashboard_delivery_userdata_options_helpImg" />
            </ui:include>

            <h:form>
                <div class="common-region common-region--no-borders common-region--three-cols">

                    <!-- user data -->
                    <div class="item flow">

                        <div class="item__icons">
                            <ui:include src="/uii/includes/icon-user.xhtml" />
                        </div>

                        <h2 class="item__heading">#{msgs.plugin_dashboard_delivery_deliverUserData}</h2>
                        <p class="item__text">#{msgs.plugin_dashboard_delivery_deliverUserDataTitle}</p>

                        <button
                            jsf:id="editUserData"
                            class="item__cta btn btn-primary-400"
                            title="#{msgs.plugin_dashboard_delivery_deliverUserDataButton}"
                            jsf:action="#{DashboardForm.plugin.startNewImport}">
                            <h:outputText value="#{msgs.plugin_dashboard_delivery_deliverUserDataButton}" />
                            <f:setPropertyActionListener
                                value="user"
                                target="#{DashboardForm.plugin.navigation}" />
                            <f:setPropertyActionListener
                                value=""
                                target="#{DashboardForm.plugin.passwordValidationError}" />

                            <f:setPropertyActionListener
                                value="true"
                                target="#{DashboardForm.plugin.oldPasswordValid}" />
                            <f:setPropertyActionListener
                                value="true"
                                target="#{DashboardForm.plugin.newPasswordValid}" />
                            <f:ajax
                                render="main-area"
                                execute="@this" />
                        </button>
                    </div>

                    <!-- institution data -->
                    <div class="item flow">

                        <div class="item__icons">
                            <ui:include src="/uii/includes/icon-institution.xhtml" />
                        </div>

                        <h2 class="item__heading">#{msgs.plugin_dashboard_delivery_deliverInstitutionData}</h2>
                        <p class="item__text">#{msgs.plugin_dashboard_delivery_deliverInstitutionDataTitle}</p>

                        <button
                            jsf:id="editInstitution"
                            class="item__cta btn btn-primary-400"
                            title="#{msgs.plugin_dashboard_delivery_deliverInstitutionDataButton}"
                            jsf:action="#{DashboardForm.plugin.startNewImport}">
                            <h:outputText value="#{msgs.plugin_dashboard_delivery_deliverInstitutionDataButton}" />
                            <f:setPropertyActionListener
                                value="institution"
                                target="#{DashboardForm.plugin.navigation}" />
                            <f:ajax
                                render="main-area"
                                execute="@this" />
                        </button>
                    </div>

                    <!-- contact person data -->
                    <div class="item flow">
                        <div class="item__icons">
                            <ui:include src="/uii/includes/icon-contact-person.xhtml" />
                        </div>

                        <h2 class="item__heading">#{msgs.plugin_dashboard_delivery_deliverContactPersonData}</h2>
                        <p class="item__text">#{msgs.plugin_dashboard_delivery_deliverContactPersonDataTitle}</p>

                        <button
                            jsf:id="editContact"
                            class="item__cta btn btn-primary-400"
                            title="#{msgs.plugin_dashboard_delivery_deliverContactPersonDataButton}"
                            jsf:action="#{DashboardForm.plugin.startNewImport}">
                            <h:outputText value="#{msgs.plugin_dashboard_delivery_deliverContactPersonDataButton}" />
                            <f:setPropertyActionListener
                                value="contact"
                                target="#{DashboardForm.plugin.navigation}" />
                            <f:ajax
                                render="main-area"
                                execute="@this" />
                        </button>
                    </div>
                </div>
            </h:form>
        </ui:fragment>

        <h:form styleClass="form-validate btn-inside">

            <ui:fragment rendered="#{DashboardForm.plugin.navigation=='user'}">

                <ui:include src="includes/helpModalsDD.xhtml">
                    <ui:param
                        name="header"
                        value="plugin_dashboard_delivery_userdata_user_helpHeader" />
                    <ui:param
                        name="body1"
                        value="plugin_dashboard_delivery_userdata_user_helpBody1" />
                    <ui:param
                        name="body2"
                        value="plugin_dashboard_delivery_userdata_user_helpBody2" />
                    <ui:param
                        name="img"
                        value="plugin_dashboard_delivery_userdata_user_helpImg" />
                </ui:include>

                <span class="common-region">
                    <ui:repeat
                        var="field"
                        value="#{DashboardForm.plugin.userData.fields}"
                        varStatus="status">
                        <h:panelGroup id="grp">
                            <zlb:field
                                identifier="field_#{status.index}"
                                labelText="#{field.label}"
                                labelHelpText="{field.helpMessage}"
                                required="#{field.required}"
                                value="#{field.value}"
                                fieldType="#{field.displayType}"
                                propertyValid="#{field.fieldValid}"
                                errorMessageText="#{field.validationErrorText}"
                                selectItems="#{field.selectList}"
                                booleanValue="#{field.booleanValue}"
                                fieldRequired="#{field.required}"
                                subValue="#{field.value2}"
                                displayDuplicateButton="#{field.cardinality == '+' or field.cardinality == '*'}"
                                render="@form"
                                showHelpBtn="#{field.displayHelpButton}"
                                helpText="#{field.helpMessage}" />
                        </h:panelGroup>
                    </ui:repeat>
                </span>

                <!-- region to set new password -->
                <span class="common-region">
                    <h:panelGroup
                        layout="block"
                        styleClass="form-group">
                        <label
                            for="old_password"
                            class="zlb-label">
                            <h:outputText
                                escape="false"
                                value="#{msgs.altesPasswort}" />
                        </label>
                        <div class="form form-field #{!DashboardForm.plugin.oldPasswordValid ? 'validate--danger' : ''}">
                            <x:inputSecret
                                id="old_password"
                                pt:aria-label="#{msgs.altesPasswort}"
                                styleClass="form-control"
                                value="#{DashboardForm.plugin.oldPassword}"
                                onfocus="focusField(this);"
                                required="false">
                                <f:passThroughAttribute
                                    name="placeholder"
                                    value="" />
                                <f:ajax execute="@this" />
                            </x:inputSecret>
                        </div>
                        <h:panelGroup
                            layout="block"
                            rendered="#{!DashboardForm.plugin.oldPasswordValid}"
                            styleClass="font-danger validation-message">
                            <h:outputText value="#{msgs.altesPasswortFalschEingegeben}" />
                        </h:panelGroup>
                        <h:outputText
                            styleClass="help-block font-light"
                            rendered="#{NavigationForm.showHelp}"
                            value="#{msgs.helpAltesPasswort}" />
                    </h:panelGroup>


                    <h:panelGroup
                        layout="block"
                        styleClass="form-group column-start">
                        <label
                            for="newPassword"
                            class="zlb-label">
                            <h:outputText
                                escape="false"
                                value="#{msgs.neuesPasswort}" />
                        </label>
                        <div class="form form-field #{!DashboardForm.plugin.newPasswordValid ? 'validate--danger' : ''}">
                            <x:inputSecret
                                id="newPassword"
                                pt:aria-label="#{msgs.neuesPasswort}"
                                styleClass="form-control"
                                value="#{DashboardForm.plugin.newPassword}"
                                onfocus="focusField(this);"
                                required="false">
                                <f:passThroughAttribute
                                    name="placeholder"
                                    value="" />
                                <f:ajax execute="@this" />
                            </x:inputSecret>
                        </div>
                        <h:panelGroup
                            layout="block"
                            rendered="#{!DashboardForm.plugin.newPasswordValid}"
                            styleClass="font-danger validation-message">
                            <h:outputText value="#{DashboardForm.plugin.passwordValidationError}" />
                        </h:panelGroup>
                        <h:outputText
                            styleClass="help-block font-light"
                            rendered="#{NavigationForm.showHelp}"
                            value="#{msgs.helpNeuesPasswort}" />
                    </h:panelGroup>

                    <h:panelGroup
                        layout="block"
                        styleClass="form-group">
                        <label
                            for="confirmnewPassword"
                            class="zlb-label">
                            <h:outputText
                                escape="false"
                                value="#{msgs.confirmNewPassword}" />
                        </label>
                        <div class="form form-field #{!DashboardForm.plugin.newPasswordValid ? 'validate--danger' : ''}">
                            <x:inputSecret
                                id="confirmnewPassword"
                                pt:aria-label="#{msgs.confirmNewPassword}"
                                styleClass="form-control"
                                value="#{DashboardForm.plugin.newPasswordRepeated}"
                                onfocus="focusField(this);"
                                required="false">
                                <f:ajax execute="@this" />
                                <f:passThroughAttribute
                                    name="placeholder"
                                    value="" />
                            </x:inputSecret>
                        </div>
                    </h:panelGroup>
                </span>
            </ui:fragment>

            <ui:fragment rendered="#{DashboardForm.plugin.navigation=='institution'}">

                <ui:include src="includes/helpModalsDD.xhtml">
                    <ui:param
                        name="header"
                        value="plugin_dashboard_delivery_userdata_institution_helpHeader" />
                    <ui:param
                        name="body1"
                        value="plugin_dashboard_delivery_userdata_institution_helpBody1" />
                    <ui:param
                        name="body2"
                        value="plugin_dashboard_delivery_userdata_institution_helpBody2" />
                    <ui:param
                        name="img"
                        value="plugin_dashboard_delivery_userdata_institution_helpImg" />
                </ui:include>

                <span class="common-region">
                    <ui:repeat
                        var="field"
                        value="#{DashboardForm.plugin.institutionData.fields}"
                        varStatus="status">

                        <h:panelGroup
                            id="grp"
                            styleClass="#{status.index == 1 ? 'column-start':''}">
                            <zlb:field
                                identifier="field_#{status.index}"
                                labelText="#{field.label}"
                                labelHelpText="{field.helpMessage}"
                                required="#{field.required}"
                                value="#{field.value}"
                                fieldType="#{field.displayType}"
                                fieldRequired="#{field.required}"
                                propertyValid="#{field.fieldValid}"
                                errorMessageText="#{field.validationErrorText}"
                                selectItems="#{field.selectList}"
                                booleanValue="#{field.booleanValue}"
                                subValue="#{field.value2}"
                                displayDuplicateButton="#{field.cardinality == '+' or field.cardinality == '*'}"
                                render="@form"
                                showHelpBtn="#{field.displayHelpButton}"
                                helpText="#{field.helpMessage}" />
                        </h:panelGroup>
                    </ui:repeat>
                </span>

            </ui:fragment>


            <ui:fragment rendered="#{DashboardForm.plugin.navigation=='contact'}">

                <ui:include src="includes/helpModalsDD.xhtml">
                    <ui:param
                        name="header"
                        value="plugin_dashboard_delivery_userdata_contact_helpHeader" />
                    <ui:param
                        name="body1"
                        value="plugin_dashboard_delivery_userdata_contact_helpBody1" />
                    <ui:param
                        name="body2"
                        value="plugin_dashboard_delivery_userdata_contact_helpBody2" />
                    <ui:param
                        name="img"
                        value="plugin_dashboard_delivery_userdata_contact_helpImg" />
                </ui:include>

                <span class="common-region">
                    <ui:repeat
                        var="field"
                        value="#{DashboardForm.plugin.contactData.fields}"
                        varStatus="status">
                        <h:panelGroup id="grp">
                            <zlb:field
                                identifier="field_#{status.index}"
                                labelText="#{field.label}"
                                labelHelpText="{field.helpMessage}"
                                required="#{field.required}"
                                value="#{field.value}"
                                fieldType="#{field.displayType}"
                                fieldRequired="#{field.required}"
                                propertyValid="#{field.fieldValid}"
                                errorMessageText="#{field.validationErrorText}"
                                selectItems="#{field.selectList}"
                                booleanValue="#{field.booleanValue}"
                                subValue="#{field.value2}"
                                displayDuplicateButton="#{field.cardinality == '+' or field.cardinality == '*'}"
                                render="@form"
                                showHelpBtn="#{field.displayHelpButton}"
                                helpText="#{field.helpMessage}" />
                        </h:panelGroup>
                    </ui:repeat>
                </span>
                <div>
                    <button
                        jsf:rendered="#{!DashboardForm.plugin.displaySecondContact}"
                        jsf:id="createNewContact"
                        jsf:action="#{DashboardForm.plugin.createNewContact}"
                        style="margin-bottom: 20px; float: right;"
                        class="btn btn-link ms-auto">

                        <ui:include src="/uii/includes/icon-plus.xhtml" />
                        <span>
                            <h:outputText value="#{msgs.plugin_rest_usercreation_new_createNewContact}" />
                        </span>
                    </button>


                </div>
                <ui:fragment rendered="#{DashboardForm.plugin.displaySecondContact}">
                    <span class="common-region">
                        <h3 class="heading__contact grid-full-width">
                            <button
                                jsf:id="disableContact"
                                jsf:action="#{DashboardForm.plugin.disableContact}"
                                style="float: right"
                                class="btn btn-link ms-auto"
                                jsf:rendered="#{DashboardForm.plugin.displaySecondContact}">

                                <span>
                                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_disableContact}" />
                                </span>
                            </button>
                        </h3>



                        <ui:repeat
                            var="field"
                            value="#{DashboardForm.plugin.contact2Data.fields}"
                            varStatus="status">
                            <h:panelGroup
                                id="grp"
                                styleClass="#{status.index == 0 ? 'column-start':''}">
                                <zlb:field
                                    identifier="field_#{status.index}"
                                    labelText="#{field.label}"
                                    labelHelpText="{field.helpMessage}"
                                    required="#{field.required}"
                                    value="#{field.value}"
                                    fieldType="#{field.displayType}"
                                    fieldRequired="#{field.required}"
                                    propertyValid="#{field.fieldValid}"
                                    errorMessageText="#{field.validationErrorText}"
                                    selectItems="#{field.selectList}"
                                    booleanValue="#{field.booleanValue}"
                                    subValue="#{field.value2}"
                                    displayDuplicateButton="#{field.cardinality == '+' or field.cardinality == '*'}"
                                    render="@form"
                                    showHelpBtn="#{field.displayHelpButton}"
                                    helpText="#{field.helpMessage}" />
                            </h:panelGroup>
                        </ui:repeat>
                    </span>
                </ui:fragment>
            </ui:fragment>

            <ui:fragment rendered="#{DashboardForm.plugin.navigation!='userdata'}">
                <div class="info-required">
                    <h:outputText
                        escape="false"
                        value="#{msgs.plugin_rest_usercreation_requiredFields}" />
                </div>
            </ui:fragment>

            <div>
                <button
                    jsf:immediate="true"
                    jsf:action="#{DashboardForm.plugin.previousPage}"
                    jsf:id="backToMain"
                    class="float-left btn btn-blank font-size-s">
                    <h:outputText value="#{msgs.plugin_rest_usercreation_back}" />
                    <f:ajax
                        render="main-area"
                        execute="@this" />
                </button>

                <ui:fragment rendered="#{DashboardForm.plugin.navigation=='user'}">
                    <button
                        jsf:action="#{DashboardForm.plugin.saveUserData}"
                        jsf:id="saveUserData"
                        class="btn btn-success grid-full-width ms-auto"
                        style="float: right;">
                        <h:outputText value="#{msgs.save}" />
                        <f:ajax
                            render="main-area"
                            execute="@this" />
                    </button>
                </ui:fragment>

                <ui:fragment rendered="#{DashboardForm.plugin.navigation=='institution'}">
                    <button
                        jsf:action="#{DashboardForm.plugin.saveInstitutionData}"
                        jsf:id="saveInstitutionData"
                        class="btn btn-success grid-full-width ms-auto"
                        style="float: right;">
                        <h:outputText value="#{msgs.save}" />
                        <f:ajax
                            render="main-area"
                            execute="@this" />
                        <f:setPropertyActionListener
                            value="userdata"
                            target="#{DashboardForm.plugin.navigation}" />
                    </button>
                </ui:fragment>

                <ui:fragment rendered="#{DashboardForm.plugin.navigation=='contact'}">
                    <button
                        jsf:action="#{DashboardForm.plugin.saveContactData}"
                        jsf:id="saveContactData"
                        class="btn btn-success grid-full-width ms-auto"
                        style="float: right;">
                        <h:outputText value="#{msgs.save}" />
                        <f:ajax
                            render="main-area"
                            execute="@this" />
                        <f:setPropertyActionListener
                            value="userdata"
                            target="#{DashboardForm.plugin.navigation}" />
                    </button>

                </ui:fragment>
            </div>

        </h:form>

    </composite:implementation>

</ui:composition>
